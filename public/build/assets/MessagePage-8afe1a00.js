import{d as r,Q as z,p as H,l as J,o as c,e as v,b as g,u as x,w as E,F,m as u,Z as K,a as i,q as y,v as U,h as D,t as q,B as P,C as B,f as $,g as X,k as ee,c as te}from"./app-d29a1c54.js";import{_ as k}from"./InputLabel-4a24d642.js";import{_ as ae}from"./PrimaryButton-f8b31512.js";import se from"./Layout-b7f944c2.js";import{A as oe}from"./Alert-c8b905ec.js";import{d as le}from"./index-ee108f99.js";import{_ as ie}from"./_plugin-vue_export-helper-c27b6911.js";/* empty css                                                               */import"./DropdownLink-7a8a95ab.js";/* empty css                                                              */const re={class:"form-group"},ue=["disabled"],ne=["value"],ce=["disabled"],de={class:"form-group"},ve=["disabled"],pe=["value"],me={key:0,class:"form-group"},fe=["disabled"],ge={class:"form-group"},he={class:"flex items-center justify-center"},_e={__name:"MessagePage",setup(ye){const a=r({to:"",subject:"",message:""}),{url:T,props:b}=z(),C=b.auth.user.email;let w=b.auth.user.user_id;const M=b.auth.user.role_id,h=new URLSearchParams(window.location.search).get("notifLogId"),l=r(null),o=r(null),p=r({show:!1,message:"",type:""}),L=T.split("/");let _=L[L.length-1];_=parseInt(_,10);const j=r([]);let d=r(""),n=r("");const O=r(["Cancer Diagnosis","Treatment Follow-up","Checkup Schedule","Patient Outcome","Data Collection"]),N=async s=>{try{let e=await u.get(`/api/doctor-profile/${s}`);o.value=e.data}catch(e){console.error(`Failed to fetch doctor with userId ${s}:`,e)}},A=async s=>{try{let e=await u.get(`/api/doctors/${s}/patients`);j.value=e.data}catch(e){console.error("Failed to fetch patients:",e)}},R=async s=>{try{let e=await u.get("/api/all-doctors");j.value=e.data}catch(e){console.error("Failed to fetch patients:",e)}},G=async s=>{try{let e=await u.get(`/api/get-user/${s}`);o.value=e.data}catch(e){console.error(`Failed to fetch user with userId ${s}:`,e)}};H(()=>a.value.to,()=>{d.value=""});function m(s){return s?s.split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()).join(" "):""}let S=b.auth.user.user_id;r(null),r(0);const Q=async()=>{try{let s=await u.get(`/api/get-patient/${_}`);a.value.to=s.data.user_id}catch(s){console.error(`Failed to fetch patient with patientId ${_}:`,s)}};r(null);const I=r(""),W=()=>{var e;const s=j.value.find(t=>t.user.user_id===a.value.to);I.value=((e=s==null?void 0:s.user)==null?void 0:e.email)||""},Y=async()=>{try{let s=await u.get(`/api/notifications/${h}`);l.value=s.data,console.log(l.value),a.value.to=l.value.notification_sender,console.log(l.value.notification_subject),O.value.includes(l.value.notification_subject)?a.value.subject=l.value.notification_subject:(a.value.subject="Others",n.value=l.value.notification_subject,console.log(l.value.notification_subject))}catch(s){console.error(`Failed to fetch doctor with userId ${S}:`,s)}},Z=async()=>{var s,e,t;p.value.show=!1;try{if(l.value&&(I.value=l.value.sender.email),M===2){if(await u.post("/api/send-email",{doctor:"Dr. "+m((s=o==null?void 0:o.value.user_details)==null?void 0:s.firstname)+" "+m((e=o==null?void 0:o.value.user_details)==null?void 0:e.lastname),hospital:(t=o==null?void 0:o.value.hospital_details)==null?void 0:t.hospital_name,from:C,to:a.value.to==="others"?d.value:I.value,subject:a.value.subject==="Others"?n.value:a.value.subject,message:a.value.message,senderId:S,receiverId:a.value.to,notificationStatus:1,notificationType:4}),l.value){const f=await u.put(`api/notification/${w}/update-status`,{notifLog_id:h,status:3})}}else if(await u.post("/api/send-email",{patient:m(o==null?void 0:o.value.firstname)+" "+m(o==null?void 0:o.value.lastname),from:C,to:a.value.to==="others"?d.value:I.value,subject:a.value.subject==="Others"?n.value:a.value.subject,message:a.value.message,senderId:S,receiverId:a.value.to,notificationStatus:1,notificationType:4}),l.value){const f=await u.put(`api/notification/${w}/update-status`,{notifLog_id:h,status:3})}p.value={show:!0,message:"Success! Your email was sent successfully.",type:"success"},le.Inertia.visit("/message")}catch(f){console.error("Failed to send email:",f),p.value={show:!0,message:"Failed to send email. Please ensure you are logged in.",type:"error"}}a.value.to="",a.value.subject="",a.value.message=""};return J(async()=>{M===2?(await N(w),await A(o==null?void 0:o.value.doctor_id),_&&(await Q(),console.log(a))):(await G(w),await R()),h&&await Y(),console.log(n.value),console.log(h)}),(s,e)=>(c(),v(F,null,[g(x(K),{title:"Message"}),g(se,null,{default:E(()=>[e[10]||(e[10]=i("div",{class:"page-heading"},[i("h1",{class:"main-heading"},"MESSAGE")],-1)),i("form",{onSubmit:ee(Z,["prevent"]),class:"form-container"},[i("div",re,[g(k,{for:"to",value:"To:"}),y(i("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>a.value.to=t),onChange:W,class:"input-field",required:"",disabled:l.value},[e[5]||(e[5]=i("option",{disabled:"",value:""},"Select an email",-1)),(c(!0),v(F,null,D(j.value,t=>{var f,V;return c(),v("option",{key:t.id,value:t.user.user_id},q(m((f=t==null?void 0:t.user)==null?void 0:f.firstname)+" "+m((V=t==null?void 0:t.user)==null?void 0:V.lastname)),9,ne)}),128)),e[6]||(e[6]=i("option",{value:"others"},"Others",-1))],40,ue),[[U,a.value.to]]),a.value.to==="others"?y((c(),v("input",{key:0,type:"email","onUpdate:modelValue":e[1]||(e[1]=t=>B(d)?d.value=t:d=t),placeholder:"Please Specify",class:"form-group",required:"",disabled:l.value},null,8,ce)),[[P,x(d)]]):$("",!0)]),i("div",de,[g(k,{for:"subject",value:"Subject:"}),y(i("select",{"onUpdate:modelValue":e[2]||(e[2]=t=>a.value.subject=t),class:"input-field",required:"",disabled:l.value},[e[7]||(e[7]=i("option",{disabled:"",value:""},"Select a subject",-1)),(c(!0),v(F,null,D(O.value,t=>(c(),v("option",{key:t,value:t},q(t),9,pe))),128)),e[8]||(e[8]=i("option",{value:"Others"},"Others",-1))],8,ve),[[U,a.value.subject]]),a.value.subject==="Others"?(c(),v("div",me,[y(i("input",{type:"text","onUpdate:modelValue":e[3]||(e[3]=t=>B(n)?n.value=t:n=t),class:"input-field",placeholder:"Please specify",required:"",disabled:l.value},null,8,fe),[[P,x(n)]])])):$("",!0)]),i("div",ge,[g(k,{for:"message",value:"Message:"}),y(i("textarea",{"onUpdate:modelValue":e[4]||(e[4]=t=>a.value.message=t),class:"message-textarea",required:""},null,512),[[P,a.value.message]])]),i("div",he,[g(ae,{class:"ms-4"},{default:E(()=>e[9]||(e[9]=[X(" Send ")])),_:1})])],32),p.value.show?(c(),te(oe,{key:0,message:p.value.message,type:p.value.type},null,8,["message","type"])):$("",!0)]),_:1})],64))}},Me=ie(_e,[["__scopeId","data-v-d9b4b48c"]]);export{Me as default};
